<!DOCTYPE html>
<html>
  <head>
    % if (stash('meta_data') && stash('meta_data')->{title}) {
      <title>Coxify - <%= stash('meta_data')->{title} %></title>
    % } else {
      <title>Coxify</title>
    % }

    <link rel="stylesheet" href="/css/bootstrap.min.css?1"/>
    <link rel="stylesheet" href="/css/coxify.css"/>
    <link rel="stylesheet" href="/css/colorbox.css"/>

    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="alternate" href="/atom.xml" type="application/atom+xml" title="All images (Atom)" />

    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="/js/jquery.colorbox.js"></script>
    <script src="/js/jquery.jkey.js"></script>

    % if (stash('next_page')) {
      <meta name="coxify-next" id="coxify-next" content="<%= stash('next_page') %>"/>
    % }

    % if (stash('prev_page')) {
      <meta name="coxify-next" id="coxify-prev" content="<%= stash('prev_page') %>"/>
    % }

    % if (config('google_analytics')) {
      <script>
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', '<%= config('google_analytics') %>']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
    % }

    <script>
      $(document).ready(function() {
        $('a[id^="year-"]').each(function() {
          var year = parseInt(this.id.replace("year-", ""));
          $("#year-" + year).click(function () {
            $("#year-ul-" + year).toggle();
          });
        });

        $('#show-days').click(function() {
          $('.day-hide').toggle();
          $(this).remove();
        });

        $(".colorbox").colorbox({opacity: 0.85});
      });

      % if (stash("next_page")) {
        $(document).jkey('d, right', function() {
          var next = $('#coxify-next');
          window.location.href = next.attr('content');
        });
      % }

      % if (stash("prev_page")) {
        $(document).jkey('a, left', function() {
          var prev = $('#coxify-prev');
          window.location.href = prev.attr('content');
        });
      % }
    </script>

    % if (stash('meta_data')) {
      % if (stash('meta_data')->{title}) {
        <meta property="og:title" content="Coxify - <%= stash('meta_data')->{title} %>" />  
      % } else {
        <meta property="og:title" content="Coxify" />
      % }
      
      <meta property="og:description" content="Coxify is your friendly neighbourhood image aggregator" />
      <meta property="og:image" content="<%= stash('meta_data')->{image}->thumb %>" />
    % }
  </head>
  <body>
    <div class="container">
      <div class="content">
        <div class="page-header">
          <h1>
            <a href="/" style="color: black">Coxify</a> 
            <small>Remember everything</small>
          </h1>
        </div>

        % if (stash('breadcrumbs')) {
          <ul class="breadcrumb">
            % for my $i (0 .. (scalar(@{ stash('breadcrumbs') }) - 1)) {
                % my $crumb = stash('breadcrumbs')->[$i];
                <li>
                  % if ($i == scalar(@{stash('breadcrumbs')}) - 1) {
                    %= $crumb->{title}
                  % } else {
                    <a href="<%= $crumb->{path} %>"><%= $crumb->{title} %></a>
                    <span class="divider">/</span>
                  % } 
                </li>
            % }
          </ul>
        % }
        <%= content %>
      </div>
      <div style="padding-top: 25px">&nbsp;</div>
    </div>
  </body>
</html>
